# 市场薪酬调研系统 - 需求规格说明书 (PRD)

## 1. 引言

### 1.1 项目背景
本系统旨在为人力资源部门提供一个高效的市场薪酬数据采集与分析工具。通过模拟爬取主流招聘网站（如 BOSS 直聘、智联招聘等）的数据，系统能够自动清洗、汇总并计算目标岗位的薪酬分位值（P25, P50, P75），帮助企业制定具有竞争力的薪酬策略。

### 1.2 系统目标
*   **数据采集自动化**：支持单点采集、批量一键采集及 Excel 导入岗位配置。
*   **数据分析智能化**：自动计算月薪与年薪的统计指标，支持通过地点（全局）和竞品（单岗位独立）进行多维筛选。
*   **报表输出便捷化**：提供可视化的图表分析及 Excel 报表导出功能。

---

## 2. 系统架构与数据流转

### 2.1 数据流转图
```mermaid
graph TD
    A[用户] -->|1. 添加/导入岗位| B(岗位管理状态 TargetPositions)
    A -->|2. 点击采集/批量采集| C{Gemini AI 模拟爬虫引擎}
    C -->|3. 关键词拓展搜索| D[获取候选岗位列表]
    D -->|4. 岗位职责语义比对| E[有效岗位判定]
    E -->|5. 竞品打标 & 数据提取| F[原始数据存储 App State]
    F -->|6. 传入分析模块| G[数据清洗与筛选]
    G -->|7a. 全局筛选 (地点/搜索)| H[初步有效数据集]
    G -->|7b. 局部筛选 (单岗位竞品)| I[最终计算数据集]
    I -->|8. 统计算法 (分位值计算)| J[分析结果 Dashboard]
    J -->|9. 导出| K[Excel 报表]
```

### 2.2 核心逻辑说明

#### 2.2.1 智能爬虫与清洗逻辑 (Intelligent Crawler & Semantic Matching)
本系统采用模拟仿真技术，核心逻辑在于解决“不同公司对同一性质岗位命名不一致”的问题。爬虫执行流程如下：

1.  **关键词拓展搜索 (Broad Search)**：
    *   系统使用用户配置的 **“目标岗位名称”** 以及 **“搜索关键词”**（如：User输入的“跨境电商运营”、“亚马逊运营”、“Amazon运营”）在各大招聘平台进行广撒网式搜索。
    *   目的：覆盖所有可能的岗位命名变体。

2.  **职责语义比对 (Responsibility Semantic Matching)**：
    *   **输入**：用户提供的 **“目标岗位职责摘要”** vs 爬取到的 **“外部招聘JD职责”**。
    *   **判定逻辑**：系统遍历所有候选岗位，进行语义分析。
        *   如果外部岗位的职责描述与目标岗位职责高度重合（例如都包含“供应商开发”、“议价谈判”），即使职称不同（如一个是“采购专员”，一个是“供应链助理”），也判定为**同一岗位**，纳入有效数据。
        *   如果关键词匹配但职责不符（例如关键词“运营”，但目标是“电商运营”，爬到的是“新媒体运营”），则判定为**无效岗位**，予以过滤剔除。
    *   **目的**：确保采集到的薪酬数据具有真实的分析意义。

3.  **竞品识别与打标 (Competitor Tagging)**：
    *   **逻辑**：系统依据用户提供的 **“竞品公司”** 列表，检查已通过职责判定的岗位所属公司名称。
    *   **处理**：若公司名称匹配（支持模糊匹配），将该条数据标记为 `isCompetitor = true`。
    *   **作用**：竞品列表**不用于限制搜索范围**（搜索范围是全网），而是用于后续的数据打标、高亮显示以及单独的竞品薪酬分析筛选。

#### 2.2.2 薪酬计算逻辑 (Statistical Calculation)
采用 **线性插值法 (Linear Interpolation)** 计算分位值，确保在样本量较小时也能得到平滑结果：
1.  **排序**：将薪资数据从小到大排序。
2.  **定位**：计算位置 $L = (P/100) \times (n + 1)$，其中 $P$ 为分位数（25, 50, 75），$n$ 为样本量。
3.  **插值**：如果 $L$ 不是整数，取 $floor(L)$ 和 $ceil(L)$ 对应的值进行加权平均。
4.  **维度**：同时计算 **月薪** (Monthly) 和 **年薪** (Yearly = 月薪 × 发薪月数)。

---

## 3. 功能模块详细说明

### 3.1 导航栏
*   **功能**：在“数据采集”和“市场分析”两个核心模块间切换。
*   **逻辑**：点击 Tab 切换路由或组件显隐，保持 `targetPositions` (岗位配置) 和 `crawledData` (已采集数据) 的状态不丢失。

### 3.2 数据采集模块 (Data Collection)

此页面用于管理目标岗位并执行数据获取操作。

#### 3.2.1 顶部操作区
| 按钮/控件 | 逻辑说明 | 交互反馈 |
| :--- | :--- | :--- |
| **Excel 批量导入** | 点击触发文件选择框，解析 `.xlsx` 文件。需包含列：`岗位名称`, `岗位职责`, `关键词`, `竞品公司`。 | 成功：弹出提示“成功导入 N 个岗位”；失败：弹出错误提示。 |
| **添加岗位** | 点击打开模态框（Modal），手动输入岗位信息。 | 填写完必填项后点击“确认添加”，列表即时更新。 |
| **一键采集所有** | 遍历所有目标岗位，**串行**（Sequential）调用 AI 接口进行采集，每条间隔 500ms 防止限流。 | 按钮变为“正在批量采集...”，列表中的采集按钮逐个显示 Loading 状态。 |

#### 3.2.2 目标岗位列表
*   **显示字段**：岗位名称、职责摘要（截断显示）、搜索关键词、主要竞品、当前数据量。
*   **操作列 - 采集/更新数据按钮**：
    *   **逻辑**：调用 `simulateMarketCrawl` 接口。
    *   **状态**：
        *   初始状态：“开始采集”
        *   已有数据：“更新数据”（点击后追加数据，不覆盖旧数据）
        *   加载中：显示 Loading 图标，按钮禁用。

#### 3.2.3 原始数据预览 (Raw Data Preview)
*   **筛选下拉框**：
    *   **逻辑**：仅列出**已有采集数据**的岗位名称。
    *   **默认值**：“显示所有岗位数据”。
    *   **行为**：选择特定岗位后，下方的表格仅展示属于该 ID 的招聘条目。
*   **数据表格**：
    *   **字段**：来源、目标岗位、招聘标题、职责摘要、公司名称（竞品标红）、地点、月薪范围、月数、福利、链接。
    *   **链接**：点击跳转到生成的模拟招聘详情页（新标签页打开）。
    *   **交互**：表格支持横向滚动 (Horizontal Scroll) 以适应较多列。

### 3.3 市场分析模块 (Analysis Dashboard)

此页面用于对已采集的数据进行清洗、筛选和统计展示。

#### 3.3.1 顶部筛选栏 (Top Filter Bar)
*   **搜索岗位 (Search)**：
    *   **UI**：带输入建议（Datalist）的输入框。
    *   **逻辑**：输入字符时，实时过滤下方的“分析卡片”。支持模糊匹配岗位名称。
*   **Base 地点筛选 (Location Filter)**：
    *   **UI**：自定义多选下拉框 (Multi-select)。
    *   **范围**：全局生效。
    *   **逻辑**：
        *   **未选**：默认为“全部地点”，参与计算所有数据。
        *   **已选**：仅保留 `JobLocation` 包含任一选中地点的记录（OR 逻辑）。

#### 3.3.2 数据概览与操作
*   **有效数据统计**：
    *   **逻辑**：`Sum(当前可见卡片的样本量)`。
    *   **说明**：该数字反映了当前屏幕上展示的所有分析结果所基于的原始数据条数总和（受搜索条件影响）。
*   **导出报表按钮**：
    *   **逻辑**：将当前筛选后的分析结果（即页面展示的卡片数据）导出为 Excel 文件。
    *   **文件名格式**：`薪酬调研分析_YYYY-MM-DD.xlsx`。
    *   **包含字段**：岗位名称、样本量、月薪(Min/P25/P50/P75/Max)、年薪(Min/P25/P50/P75/Max)。

#### 3.3.3 分析卡片 (Stats Card)
每个目标岗位对应一张独立的卡片。

*   **卡片头部**：
    *   **岗位信息**：显示岗位名称、关键词、当前样本量。
    *   **独立竞品筛选器 (Position Competitor Filter)**：
        *   **位置**：卡片右上角。
        *   **数据源**：动态生成，仅显示该岗位实际采集到的公司列表。
        *   **选项逻辑**：
            1.  **全选**（默认）：包含所有公司。
            2.  **只看竞品**：仅筛选出在后台配置中标记为“竞品”的公司数据。
            3.  **自定义选择**：勾选特定的公司名称。
        *   **视觉反馈**：竞品公司名称右侧显示红色的“竞品”标签。
        *   **作用域**：仅影响当前卡片内的薪酬统计结果。

*   **统计内容区**：
    *   **月薪分析表**：展示 Min, P25, P50, P75, Max 的月薪统计（人民币）。
    *   **年薪分析表**：展示 Min, P25, P50, P75, Max 的年薪统计（考虑了 13薪/14薪等因素）。
    *   **高亮**：P50 行背景加深高亮，便于快速查阅。
    *   **空状态**：若当前筛选条件下（如选了特定竞品但该竞品无数据）样本量为 0，显示“无有效数据”提示。

#### 3.3.4 薪酬中位数对比图 (Chart)
*   **类型**：柱状图 (Bar Chart)。
*   **数据源**：联动所有卡片的最终计算结果（P50值）。
*   **X轴**：岗位名称。
*   **Y轴**：金额 (RMB)。
*   **系列**：
    *   蓝色柱：月薪中位数。
    *   绿色柱：年薪中位数。
*   **交互**：悬停显示具体数值。

---

## 4. 非功能需求

### 4.1 性能与体验
*   **响应速度**：筛选操作需在 100ms 内完成，实现“即输即显”的流畅体验。
*   **异常处理**：若 API 调用失败（如 Key 无效或网络问题），需在界面显示红色错误提示，不阻塞其他操作。
*   **空状态设计**：在无数据、无搜索结果时提供明确的引导文案和占位图标。

### 4.2 兼容性
*   系统适配 Chrome, Edge, Safari 等主流现代浏览器。
*   支持响应式布局，适配 1366x768 及以上分辨率屏幕。

## 5. 附录：Excel 导入模板规范

| 列名 (支持别名) | 必填 | 说明 |
| :--- | :--- | :--- |
| **岗位名称** (Position) | 是 | 目标岗位的标准名称 |
| **岗位职责** (Responsibilities) | 是 | 简要描述，用于辅助 AI 生成匹配数据 |
| **关键词** (Keywords) | 否 | 多个关键词用逗号分隔 |
| **竞品公司** (Competitors) | 否 | 多个公司名用逗号分隔 |